<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>æ¨¡ç‰ˆå¹¿åœº - è„‰å›¾</title>
  <link rel="stylesheet" href="styles.css">
  <style>
    /* å…¨å±€æ ·å¼é‡ç½® - ä¼˜å…ˆçº§æœ€é«˜ */
    html, body {
      height: auto !important;
      overflow: auto !important;
      overflow-y: auto !important;
      overflow-x: hidden !important;
    }
    
    body {
      min-height: 100vh;
      margin: 0;
      padding: 20px !important;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    
    /* å®¹å™¨æ ·å¼é‡ç½® */
    .container {
      height: auto !important;
      max-height: none !important;
    }
    
    .page {
      height: auto !important;
      overflow: visible !important;
    }
    
    .main-content {
      height: auto !important;
      overflow: visible !important;
    }
    
    /* æ¨¡ç‰ˆå¹¿åœºæ ·å¼ */
    .templates-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      min-height: calc(100vh - 40px);
    }
    
    /* é¡¶éƒ¨å¯¼èˆªæ  */
    .top-nav {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding: 20px 0;
    }
    
    .top-nav-left h1 {
      margin: 0;
      color: #333;
      font-size: 32px;
      font-weight: 700;
      letter-spacing: -0.5px;
      background: linear-gradient(135deg, #4a6fa5, #6b8cce);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }
    
    .top-nav-right .back-btn {
      padding: 10px 20px;
      background: rgba(255, 255, 255, 0.9);
      color: #4a6fa5;
      border: 0px solid #4a6fa5;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }
    
    .top-nav-right .back-btn:hover {
      background: #4a6fa5;
      color: white;
      box-shadow: 0 4px 12px rgba(74, 111, 165, 0.4);
      transform: translateY(-2px);
    }
    
    /* æœç´¢åŒºåŸŸ */
    .search-section {
      background: transparent;
      padding: 20px 0;
      margin-bottom: 30px;
      text-align: center;
      border: none;
      transition: all 0.3s ease;
    }
    
    .search-section:hover {
      transform: translateY(-2px);
    }
    
    .search-box {
      display: flex;
      max-width: 650px;
      margin: 0 auto;
      gap: 12px;
      align-items: center;
    }
    
    .search-box input {
      flex: 1;
      padding: 16px 20px;
      border: 3px solid rgba(74, 111, 165, 0.2);
      border-radius: 12px;
      font-size: 16px;
      background: rgba(255, 255, 255, 0.9);
      transition: all 0.3s ease;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }
    
    .search-box input::placeholder {
      color: #999;
      font-style: italic;
    }
    
    .search-box input:focus {
      outline: none;
      border-color: #4a6fa5;
      background: rgba(255, 255, 255, 1);
      box-shadow: 0 0 0 4px rgba(74, 111, 165, 0.15), 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-1px);
    }
    
    .search-box button {
      padding: 16px 32px;
      background: linear-gradient(135deg, #4a6fa5, #6b8cce);
      color: white;
      border: none;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 16px rgba(74, 111, 165, 0.4);
      position: relative;
      overflow: hidden;
    }
    
    .search-box button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
      transition: left 0.5s ease;
    }
    
    .search-box button:hover::before {
      left: 100%;
    }
    
    .search-box button:hover {
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
      transform: translateY(-2px);
    }
    
    .search-box button:active {
      transform: translateY(0);
      box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
    }
    
    /* åˆ†ç»„åŒºåŸŸ */
    .groups-section {
      margin-bottom: 30px;
    }
    
    .groups-section h2 {
      margin: 0 0 20px 0;
      color: #333;
      font-size: 20px;
    }
    
    .groups-list {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
    }
    
    .group-tag {
      padding: 8px 16px;
      background: #f0f0f0;
      border: 1px solid #ddd;
      border-radius: 20px;
      font-size: 14px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .group-tag:hover,
    .group-tag.active {
      background: #4a6fa5;
      color: white;
      border-color: #4a6fa5;
    }
    
    /* æ¨¡ç‰ˆåˆ—è¡¨ */
    .templates-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }
    
    .template-card {
      background: white;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
      cursor: pointer;
    }
    
    .template-card:hover {
      transform: translateY(-4px);
      box-shadow: 0 4px 16px rgba(0,0,0,0.15);
    }
    
    .template-thumbnail {
      width: 100%;
      height: 180px;
      background: #f8f9fa;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    
    .template-thumbnail img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    
    .template-thumbnail .placeholder {
      font-size: 14px;
      color: #999;
    }
    
    .template-info {
      padding: 16px;
    }
    
    .template-title {
      font-size: 16px;
      font-weight: 600;
      color: #333;
      margin: 0 0 8px 0;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    
    .template-description {
      font-size: 14px;
      color: #666;
      margin: 0 0 12px 0;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }
    
    .template-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 12px;
      color: #999;
    }
    
    .template-stats {
      display: flex;
      gap: 12px;
    }
    
    .template-actions {
      display: flex;
      gap: 8px;
    }
    
    .template-actions button {
      padding: 6px 12px;
      background: #f0f0f0;
      border: none;
      border-radius: 4px;
      font-size: 12px;
      cursor: pointer;
      transition: background-color 0.3s ease;
    }
    
    .template-actions button:hover {
      background: #e0e0e0;
    }
    
    .template-actions .use-btn {
      background: #4a6fa5;
      color: white;
    }
    
    .template-actions .use-btn:hover {
      background: #3d5a80;
    }
    
    /* åŠ è½½æ›´å¤š */
    .load-more {
      text-align: center;
      margin-top: 40px;
    }
    
    .load-more button {
      padding: 12px 24px;
      background: white;
      border: 0px solid #4a6fa5;
      color: #4a6fa5;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .load-more button:hover {
      background: #4a6fa5;
      color: white;
    }
    
    /* å“åº”å¼è®¾è®¡ */
    @media (max-width: 768px) {
      .templates-container {
        padding: 10px;
      }
      
      .search-section {
        padding: 20px;
      }
      
      .search-box {
        flex-direction: column;
      }
      
      .templates-grid {
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
        gap: 16px;
      }
    }
  </style>
</head>
<body>
  <div class="templates-container">
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    <div class="top-nav">
      <!-- <div class="top-nav-left">
        <h1>æ¨¡ç‰ˆå¹¿åœº</h1>
      </div> -->
      <div class="top-nav-right">
        <button class="back-btn" onclick="window.location.href='/my.html'">
          â† æˆ‘çš„å›¾è¡¨
        </button>
      </div>
    </div>
    
    <!-- æœç´¢åŒºåŸŸ -->
    <div class="search-section">
      <div class="search-box">
        <input type="text" placeholder="æœç´¢æ¨¡ç‰ˆ...">
        <button>æœç´¢</button>
      </div>
    </div>
    
    <!-- åˆ†ç»„åŒºåŸŸ -->
    <div class="groups-section">
      <!-- <h2>åˆ†ç±»æµè§ˆ</h2> -->
      <div class="groups-list">
        <div class="group-tag active">å…¨éƒ¨</div>
        <div class="group-tag">æ€ç»´å¯¼å›¾</div>
        <div class="group-tag">å…³ç³»å›¾</div>
        <div class="group-tag">æµç¨‹å›¾</div>
        <div class="group-tag">ç»„ç»‡æ¶æ„</div>
        <div class="group-tag">é¡¹ç›®ç®¡ç†</div>
        <div class="group-tag">å­¦ä¹ ç¬”è®°</div>
        <div class="group-tag">å•†ä¸šåˆ†æ</div>
      </div>
    </div>
    
    <!-- æ¨¡ç‰ˆåˆ—è¡¨ -->
    <div class="templates-grid">
      <!-- æ¨¡ç‰ˆå¡ç‰‡ 1 -->
      <div class="template-card">
        <div class="template-thumbnail">
          <div class="placeholder">æ€ç»´å¯¼å›¾æ¨¡ç‰ˆ</div>
        </div>
        <div class="template-info">
          <h3 class="template-title">é¡¹ç›®è§„åˆ’æ€ç»´å¯¼å›¾</h3>
          <p class="template-description">ç”¨äºé¡¹ç›®åˆæœŸè§„åˆ’ï¼ŒåŒ…å«é¡¹ç›®ç›®æ ‡ã€æ—¶é—´çº¿ã€èµ„æºåˆ†é…ç­‰å…³é”®è¦ç´ </p>
          <div class="template-meta">
            <div class="template-stats">
              <span>ä½¿ç”¨ 128</span>
              <span>æ”¶è— 36</span>
            </div>
            <div class="template-actions">
              <button class="use-btn">ä½¿ç”¨</button>
              <button>æ”¶è—</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- æ¨¡ç‰ˆå¡ç‰‡ 2 -->
      <div class="template-card">
        <div class="template-thumbnail">
          <div class="placeholder">å…³ç³»å›¾æ¨¡ç‰ˆ</div>
        </div>
        <div class="template-info">
          <h3 class="template-title">äº§å“åŠŸèƒ½å…³ç³»å›¾</h3>
          <p class="template-description">å±•ç¤ºäº§å“å„åŠŸèƒ½æ¨¡å—ä¹‹é—´çš„å…³è”å…³ç³»ï¼Œå¸®åŠ©äº§å“ç»ç†æ¢³ç†åŠŸèƒ½é€»è¾‘</p>
          <div class="template-meta">
            <div class="template-stats">
              <span>ä½¿ç”¨ 95</span>
              <span>æ”¶è— 28</span>
            </div>
            <div class="template-actions">
              <button class="use-btn">ä½¿ç”¨</button>
              <button>æ”¶è—</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- æ¨¡ç‰ˆå¡ç‰‡ 3 -->
      <div class="template-card">
        <div class="template-thumbnail">
          <div class="placeholder">æµç¨‹å›¾æ¨¡ç‰ˆ</div>
        </div>
        <div class="template-info">
          <h3 class="template-title">ç”¨æˆ·æ³¨å†Œæµç¨‹å›¾</h3>
          <p class="template-description">æ ‡å‡†çš„ç”¨æˆ·æ³¨å†Œæµç¨‹ï¼ŒåŒ…å«éªŒè¯ã€æ¿€æ´»ç­‰å…³é”®æ­¥éª¤</p>
          <div class="template-meta">
            <div class="template-stats">
              <span>ä½¿ç”¨ 156</span>
              <span>æ”¶è— 42</span>
            </div>
            <div class="template-actions">
              <button class="use-btn">ä½¿ç”¨</button>
              <button>æ”¶è—</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- æ¨¡ç‰ˆå¡ç‰‡ 4 -->
      <div class="template-card">
        <div class="template-thumbnail">
          <div class="placeholder">ç»„ç»‡æ¶æ„æ¨¡ç‰ˆ</div>
        </div>
        <div class="template-info">
          <h3 class="template-title">å…¬å¸ç»„ç»‡æ¶æ„å›¾</h3>
          <p class="template-description">æ ‡å‡†çš„å…¬å¸ç»„ç»‡æ¶æ„æ¨¡æ¿ï¼ŒåŒ…å«ç®¡ç†å±‚ã€å„éƒ¨é—¨åŠå²—ä½è®¾ç½®</p>
          <div class="template-meta">
            <div class="template-stats">
              <span>ä½¿ç”¨ 87</span>
              <span>æ”¶è— 24</span>
            </div>
            <div class="template-actions">
              <button class="use-btn">ä½¿ç”¨</button>
              <button>æ”¶è—</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- æ¨¡ç‰ˆå¡ç‰‡ 5 -->
      <div class="template-card">
        <div class="template-thumbnail">
          <div class="placeholder">æ€ç»´å¯¼å›¾æ¨¡ç‰ˆ</div>
        </div>
        <div class="template-info">
          <h3 class="template-title">å­¦ä¹ ç¬”è®°æ€ç»´å¯¼å›¾</h3>
          <p class="template-description">ç”¨äºæ•´ç†å­¦ä¹ å†…å®¹ï¼ŒåŒ…å«çŸ¥è¯†ç‚¹ã€é‡ç‚¹ã€éš¾ç‚¹ç­‰å†…å®¹çš„å±‚çº§ç»“æ„</p>
          <div class="template-meta">
            <div class="template-stats">
              <span>ä½¿ç”¨ 112</span>
              <span>æ”¶è— 31</span>
            </div>
            <div class="template-actions">
              <button class="use-btn">ä½¿ç”¨</button>
              <button>æ”¶è—</button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- æ¨¡ç‰ˆå¡ç‰‡ 6 -->
      <div class="template-card">
        <div class="template-thumbnail">
          <div class="placeholder">æµç¨‹å›¾æ¨¡ç‰ˆ</div>
        </div>
        <div class="template-info">
          <h3 class="template-title">è¯·å‡å®¡æ‰¹æµç¨‹å›¾</h3>
          <p class="template-description">æ ‡å‡†çš„ä¼ä¸šè¯·å‡å®¡æ‰¹æµç¨‹ï¼ŒåŒ…å«ç”³è¯·ã€å®¡æ‰¹ã€å½’æ¡£ç­‰æ­¥éª¤</p>
          <div class="template-meta">
            <div class="template-stats">
              <span>ä½¿ç”¨ 76</span>
              <span>æ”¶è— 19</span>
            </div>
            <div class="template-actions">
              <button class="use-btn">ä½¿ç”¨</button>
              <button>æ”¶è—</button>
            </div>
          </div>
        </div>
      </div>
    </div>
    
    <!-- åŠ è½½æ›´å¤š -->
    <div class="load-more">
      <button>åŠ è½½æ›´å¤š</button>
    </div>
  </div>
  
  <script>
    // ä»æœåŠ¡å™¨è·å–é…ç½®ä¿¡æ¯
    fetch('/api/config')
      .then(res => res.json())
      .then(config => {
        window.APP_CONFIG = config;
      })
      .catch(err => {
        console.error('è·å–é…ç½®å¤±è´¥ï¼Œä½¿ç”¨é»˜è®¤é…ç½®:', err);
        window.APP_CONFIG = {
          drawioUrl: 'http://localhost:8080'
        };
      });

    // åˆ†ç»„æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
    document.querySelectorAll('.group-tag').forEach(tag => {
      tag.addEventListener('click', function() {
        // ç§»é™¤æ‰€æœ‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
        document.querySelectorAll('.group-tag').forEach(t => t.classList.remove('active'));
        // æ·»åŠ å½“å‰æ ‡ç­¾çš„æ¿€æ´»çŠ¶æ€
        this.classList.add('active');
        // è¿™é‡Œå¯ä»¥æ·»åŠ ç­›é€‰é€»è¾‘
        const groupName = this.textContent;
        loadTemplates(groupName === 'å…¨éƒ¨' ? '' : groupName);
      });
    });
    
    // æœç´¢åŠŸèƒ½
    document.querySelector('.search-box button').addEventListener('click', function() {
      const searchText = document.querySelector('.search-box input').value;
      console.log('æœç´¢:', searchText);
      // è¿™é‡Œå¯ä»¥æ·»åŠ æœç´¢é€»è¾‘
      loadTemplates('', searchText);
    });
    
    // åŠ è½½æ›´å¤šåŠŸèƒ½
    document.querySelector('.load-more button').addEventListener('click', function() {
      console.log('åŠ è½½æ›´å¤šæ¨¡ç‰ˆ');
      // è¿™é‡Œå¯ä»¥æ·»åŠ åŠ è½½æ›´å¤šé€»è¾‘
    });
    
    // æ¨¡ç‰ˆå¡ç‰‡ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', function(e) {
      const card = e.target.closest('.template-card');
      if (card) {
        // å¦‚æœç‚¹å‡»çš„æ˜¯æŒ‰é’®ï¼Œä¸è§¦å‘å¡ç‰‡ç‚¹å‡»
        if (e.target.tagName === 'BUTTON') return;
        console.log('ç‚¹å‡»æ¨¡ç‰ˆå¡ç‰‡:', card.querySelector('.template-title').textContent);
        // è¿™é‡Œå¯ä»¥æ·»åŠ æ‰“å¼€æ¨¡ç‰ˆè¯¦æƒ…çš„é€»è¾‘
      }
    });
    
    // ä½¿ç”¨æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('use-btn')) {
        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
        const card = e.target.closest('.template-card');
        const graphId = card.dataset.graphId;
        console.log('ä½¿ç”¨æ¨¡ç‰ˆ:', card.querySelector('.template-title').textContent, 'Graph ID:', graphId);
        // ä½¿ç”¨æ¨¡ç‰ˆçš„é€»è¾‘
        useTemplate(graphId);
      }
    });
    
    // æ”¶è—æŒ‰é’®ç‚¹å‡»äº‹ä»¶
    document.addEventListener('click', function(e) {
      if (e.target.classList.contains('favorite-btn')) {
        e.stopPropagation(); // é˜»æ­¢äº‹ä»¶å†’æ³¡
        const card = e.target.closest('.template-card');
        console.log('æ”¶è—æ¨¡ç‰ˆ:', card.querySelector('.template-title').textContent);
        // è¿™é‡Œå¯ä»¥æ·»åŠ æ”¶è—æ¨¡ç‰ˆçš„é€»è¾‘
      }
    });

    // åŠ è½½å…±äº«çš„å›¾è¡¨æ¨¡æ¿
    async function loadTemplates(group = '', searchText = '') {
      try {
        const templatesGrid = document.querySelector('.templates-grid');
        templatesGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">åŠ è½½ä¸­...</div>';

        // ä»æœåŠ¡å™¨è·å–å…±äº«çš„å›¾è¡¨æ•°æ®
        const sharedGraphs = await fetch('/api/graphs/shared').then(res => res.json());

        // ç¡®ä¿ sharedGraphs æ˜¯æ•°ç»„
        let sharedGraphsArray = Array.isArray(sharedGraphs) ? sharedGraphs : [];

        // ç­›é€‰æ•°æ®
        let filteredGraphs = sharedGraphsArray;
        if (group) {
          filteredGraphs = filteredGraphs.filter(graph => graph.diagramType === group.toLowerCase());
        }
        if (searchText) {
          const searchLower = searchText.toLowerCase();
          filteredGraphs = filteredGraphs.filter(graph => 
            graph.name.toLowerCase().includes(searchLower) || 
            graph.description.toLowerCase().includes(searchLower)
          );
        }

        // æ¸²æŸ“æ¨¡æ¿å¡ç‰‡
        if (filteredGraphs.length === 0) {
          templatesGrid.innerHTML = '<div style="text-align: center; padding: 40px; color: #666;">æš‚æ— å…±äº«çš„å›¾è¡¨æ¨¡æ¿</div>';
          return;
        }

        templatesGrid.innerHTML = filteredGraphs.map(graph => `
          <div class="template-card" data-graph-id="${graph.id}">
            <div class="template-thumbnail">
              ${graph.thumbnail && graph.thumbnail.startsWith('data:image') ? 
                `<img src="${graph.thumbnail}" style="width:100%;height:180px;object-fit:contain;display:block;background:#fff;" alt="${graph.name}">` : 
                `<div class="placeholder">${getDiagramTypeIcon(graph.diagramType)} ${getDiagramTypeName(graph.diagramType)}æ¨¡æ¿</div>`
              }
            </div>
            <div class="template-info">
              <h3 class="template-title">${graph.name || 'æœªå‘½åå›¾è¡¨'}</h3>
              <p class="template-description">${graph.description || 'æš‚æ— æè¿°'}</p>
              <div class="template-meta">
                <div class="template-stats">
                  <span>ä½¿ç”¨ ${Math.floor(Math.random() * 200) + 1}</span>
                  <span>æ”¶è— ${Math.floor(Math.random() * 50) + 1}</span>
                </div>
                <div class="template-actions">
                  <button class="use-btn">ä½¿ç”¨</button>
                  <button class="favorite-btn">æ”¶è—</button>
                </div>
              </div>
            </div>
          </div>
        `).join('');
      } catch (err) {
        console.error('åŠ è½½æ¨¡æ¿å¤±è´¥:', err);
        document.querySelector('.templates-grid').innerHTML = '<div style="text-align: center; padding: 40px; color: #e53935;">åŠ è½½å¤±è´¥ï¼Œè¯·é‡è¯•</div>';
      }
    }

    // è·å–å›¾è¡¨ç±»å‹å›¾æ ‡
    function getDiagramTypeIcon(type) {
      const icons = {
        'relationship': 'âšª',
        'mindmap': 'ğŸŒ³',
        'flow': 'â¬…'
      };
      return icons[type] || 'ğŸ“‹';
    }

    // è·å–å›¾è¡¨ç±»å‹åç§°
    function getDiagramTypeName(type) {
      const names = {
        'relationship': 'å…³ç³»å›¾',
        'mindmap': 'æ€ç»´å¯¼å›¾',
        'flow': 'æµç¨‹å›¾'
      };
      return names[type] || 'å›¾è¡¨';
    }

    // ä½¿ç”¨æ¨¡æ¿
    async function useTemplate(graphId) {
      try {
        // åˆ›å»ºæ¨¡æ¿çš„å‰¯æœ¬
        const newGraph = await fetch(`/api/graphs/${graphId}/duplicate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ name: 'ä»æ¨¡æ¿åˆ›å»º' })
        }).then(res => res.json());

        // æ ¹æ®å›¾è¡¨ç±»å‹é€‰æ‹©ç¼–è¾‘å™¨
        const graph = await fetch(`/api/graphs/${newGraph.id}`).then(res => res.json());
        if (graph.diagramType === 'relationship') {
          // å…³ç³»å›¾æ‰“å¼€æœ¬åœ°çš„å…³ç³»å›¾ç¼–è¾‘å™¨
          window.open('/g/' + newGraph.id, '_blank');
        } else if (graph.diagramType === 'mindmap') {
          // æ€ç»´å¯¼å›¾æ‰“å¼€æœ¬åœ°çš„æ€ç»´å¯¼å›¾ç¼–è¾‘å™¨
          window.open('/m/' + newGraph.id, '_blank');
        } else {
          // æµç¨‹å›¾ã€æ³³é“å›¾æ‰“å¼€draw.ioç¼–è¾‘å™¨
          const drawioUrl = window.APP_CONFIG?.drawioUrl || 'http://localhost:8080';
          const apiBaseUrl = window.APP_CONFIG?.apiBaseUrl || 'http://localhost:3000';
          window.open(drawioUrl + '?graphId=' + newGraph.id + '&lang=zh&dev=1&apiBaseUrl=' + apiBaseUrl, '_blank');
        }
      } catch (err) {
        console.error('ä½¿ç”¨æ¨¡æ¿å¤±è´¥:', err);
        alert('ä½¿ç”¨æ¨¡æ¿å¤±è´¥ï¼Œè¯·é‡è¯•');
      }
    }

    // é¡µé¢åŠ è½½æ—¶åŠ è½½æ¨¡æ¿
    window.addEventListener('DOMContentLoaded', function() {
      loadTemplates();
    });
  </script>
</body>
</html>