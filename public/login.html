<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>è„‰å›¾ - è®©å…³ç³»ï¼Œä¸€ç›®äº†ç„¶</title>
  <link rel="stylesheet" href="/styles.css" /> 
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 20px;
    }
    .login-container {
      display: flex;
      background: #fff;
      border-radius: 20px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      overflow: hidden;
      max-width: 900px;
      width: 100%;
      min-height: 500px;
      max-height: 90vh;
    }
    .left-panel {
      flex: 1.1;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
      padding: 40px 32px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      position: relative;
      overflow: hidden;
    }
    .left-panel::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="75" cy="75" r="1" fill="rgba(255,255,255,0.1)"/><circle cx="50" cy="10" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="10" cy="50" r="0.5" fill="rgba(255,255,255,0.05)"/><circle cx="90" cy="30" r="0.5" fill="rgba(255,255,255,0.05)"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
      opacity: 0.3;
    }
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }
    .logo-icon {
      width: 48px;
      height: 48px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      overflow: hidden;
    }
    .logo-icon img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
    .logo-text {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }
    .slogan {
      font-size: 32px;
      font-weight: 700;
      line-height: 1.3;
      margin-bottom: 16px;
      position: relative;
      z-index: 1;
    }
    .description {
      font-size: 15px;
      line-height: 1.7;
      opacity: 0.9;
      margin-bottom: 24px;
      position: relative;
      z-index: 1;
    }
    .features {
      display: flex;
      flex-direction: column;
      gap: 12px;
      position: relative;
      z-index: 1;
    }
    .feature-item {
      display: flex;
      align-items: flex-start;
      gap: 12px;
    }
    .feature-icon {
      width: 24px;
      height: 24px;
      background: rgba(255,255,255,0.2);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      margin-top: 2px;
    }
    .feature-text {
      font-size: 14px;
      line-height: 1.6;
      opacity: 0.95;
    }
    .right-panel {
      flex: 1;
      padding: 40px 32px;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }
    .login-header {
      text-align: center;
      margin-bottom: 24px;
    }
    .login-title {
      font-size: 28px;
      font-weight: 700;
      color: #333;
      margin-bottom: 8px;
    }
    .login-subtitle {
      font-size: 14px;
      color: #999;
    }
    .login-methods {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }
    .wechat-login-section {
      text-align: center;
    }
    .wechat-header {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .wechat-icon {
      width: 40px;
      height: 40px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: #fff;
    }
    .wechat-title {
      font-size: 20px;
      font-weight: 600;
      color: #333;
    }
    .wechat-desc {
      font-size: 13px;
      color: #999;
      line-height: 1.5;
      margin-bottom: 16px;
    }
    .dev-login-link {
      text-align: center;
      color: #667eea;
      font-size: 13px;
      cursor: pointer;
      transition: color 0.3s ease;
    }
    .dev-login-link:hover {
      color: #764ba2;
      text-decoration: underline;
    }

    .qr-box {
      background: #f9fafb;
      border: 2px dashed #d1d5db;
      border-radius: 16px;
      padding: 20px;
      text-align: center;
      min-height: 220px;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 12px;
    }
    .qr-status {
      font-size: 14px;
      color: #666;
    }
    .qr-image {
      max-width: 160px;
      border-radius: 12px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    .qr-actions {
      display: flex;
      gap: 12px;
      justify-content: center;
      margin-top: 20px;
    }
    .btn {
      padding: 12px 24px;
      border-radius: 10px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      border: none;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: #fff;
    }
    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 6px 16px rgba(102,126,234,0.4);
    }
    .btn-secondary {
      background: #f3f4f6;
      color: #666;
    }
    .btn-secondary:hover {
      background: #e5e7eb;
    }

    .footer {
      text-align: center;
      margin-top: 24px;
      padding-top: 16px;
      border-top: 1px solid #e5e7eb;
    }
    .footer-text {
      font-size: 12px;
      color: #999;
    }
    @media (max-width: 768px) {
      .login-container {
        flex-direction: column;
        min-height: auto;
      }
      .left-panel {
        padding: 40px 24px;
        min-height: 300px;
      }
      .right-panel {
        padding: 40px 24px;
      }
      .slogan {
        font-size: 28px;
      }
      .logo-text {
        font-size: 24px;
      }
    }
  </style>
  <script src="sweetalert2@11.js"></script>
</head>
<body>
  <div class="login-container">
    <div class="left-panel">
      <div class="logo">
        <div class="logo-icon">
          <img src="images/logo.png" alt="è„‰å›¾">
        </div>
        <div class="logo-text">MindMaple | è„‰å›¾</div>
      </div>
      <h1 class="slogan">è®©å…³ç³»ï¼Œä¸€ç›®äº†ç„¶</h1>
      <p class="description">ä¸–ä¸Šæ— éš¾äº‹ï¼Œåªè¦è‚¯æ¢³ç†ã€‚è„‰å›¾ï¼Œç”¨â€œå›¾â€çš„æ–¹å¼æŠŠå¤æ‚å…³ç³»ç†æ¸…æ¥šã€‚</p>
      <div class="features">
        <div class="feature-item">
          <div class="feature-icon">ğŸ¢</div>
          <div class="feature-text">ç»„ç»‡ç»“æ„ï¼šå¦‚é›†å›¢ã€å…¬å¸ã€éƒ¨é—¨ã€å²—ä½ã€è§’è‰²ï¼Œæ¢³ç†æ¸…æ¥šå„è‡ªçš„ç›®æ ‡ã€èŒè´£ã€æƒåŠ›ï¼Œæé«˜ç»„ç»‡è¿è½¬æ•ˆç‡</div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">ğŸ‘¤</div>
          <div class="feature-text">äººç‰©å…³ç³»ï¼šå¦‚äº²å‹ã€åˆä½œã€ç«äº‰ã€ä¾èµ–ç­‰ï¼Œæ¢³ç†æ¸…æ¥šäººç‰©ä¹‹é—´çš„å…³ç³»ï¼Œç¥æ‚¨ç†æ¸…äº‹æƒ…èƒŒåçš„åŸå› </div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">ğŸ“ˆ</div>
          <div class="feature-text">äº‹ä»¶å‘å±•ï¼šå¦‚é¡¹ç›®ã€ä»»åŠ¡ã€äº‹ä»¶ç­‰ï¼Œåšå¥½é¢„æµ‹ã€é¢„åˆ¤ï¼Œæå‰è§„é¿é£é™©</div>
        </div>
        <div class="feature-item">
          <div class="feature-icon">ğŸŒ</div>
          <div class="feature-text">å…¶ä»–ï¼šæ—¶é—´è½´ã€æ—è°±ã€æ ‘å›¾ç­‰ç­‰ï¼Œæ›´å¤šåœºæ™¯å¾…æ‚¨å‘ç°
          </div>
        </div>
      </div>
    </div>
    <div class="right-panel">
      <div class="login-methods">
        <div class="wechat-login-section">
          <div class="wechat-header">
            <div class="wechat-title">å¾®ä¿¡æ‰«ç ç™»å½•</div>
          </div>
          <div class="qr-box">
            <div class="qr-status" id="qrStatus">æ­£åœ¨è·å–äºŒç»´ç â€¦</div>
            <img id="qrImage" class="qr-image" style="display: none;" alt="å¾®ä¿¡äºŒç»´ç ">
            <a id="qrLink" href="#" target="_blank" rel="noreferrer" style="display: none; color: #667eea; text-decoration: none; font-size: 13px;">æ‰“å¼€å¾®ä¿¡æ‰«ç é“¾æ¥</a>
          </div>
          <div class="qr-actions">
            <button class="btn btn-secondary" id="btnRefreshQr">åˆ·æ–°äºŒç»´ç </button>
          </div>
        </div>
        <div class="dev-login-link" onclick="handleMockLogin()">
          <span>ğŸ”§ å¼€å‘æ¨¡å¼ç™»å½•</span>
        </div>
      </div>
      <div class="footer">
        <p class="footer-text">ç™»å½•å³è¡¨ç¤ºæ‚¨åŒæ„<a href="#" style="color: #667eea; text-decoration: none;">ã€Šç”¨æˆ·åè®®ã€‹</a>å’Œ<a href="#" style="color: #667eea; text-decoration: none;">ã€Šéšç§æ”¿ç­–ã€‹</a></p>
      </div>
    </div>
  </div>

  <script>
    async function fetchJson(url, opts) {
      const res = await fetch(url, opts);
      const data = await res.json().catch(() => ({}));
      if (!res.ok) throw new Error(data.error || ('HTTP ' + res.status));
      return data;
    }

    async function checkStatus() {
      const s = await fetchJson('/api/auth/status');
      if (s.loggedIn) window.location.href = '/my';
    }

    async function refreshQr() {
      const qrStatus = document.getElementById('qrStatus');
      const qrImage = document.getElementById('qrImage');
      const qrLink = document.getElementById('qrLink');
      
      qrStatus.textContent = 'æ­£åœ¨è·å–äºŒç»´ç â€¦';
      qrImage.style.display = 'none';
      qrLink.style.display = 'none';
      
      try {
        const qr = await fetchJson('/api/auth/wechat-qr');
        if (qr.imageUrl) {
          qrStatus.textContent = 'è¯·ä½¿ç”¨å¾®ä¿¡æ‰«ç å…³æ³¨å…¬ä¼—å·';
          qrImage.src = qr.imageUrl;
          qrImage.style.display = 'block';
        } else if (qr.url) {
          qrStatus.textContent = 'è¯·ä½¿ç”¨å¾®ä¿¡æ‰«ç å…³æ³¨å…¬ä¼—å·';
          qrLink.href = qr.url;
          qrLink.textContent = 'æ‰“å¼€å¾®ä¿¡æ‰«ç é“¾æ¥';
          qrLink.style.display = 'block';
        } else {
          qrStatus.textContent = 'å¾®ä¿¡ç™»å½•æœªé…ç½®ï¼Œè¯·ä½¿ç”¨å¼€å‘æ¨¡å¼ç™»å½•';
        }
      } catch (err) {
        qrStatus.textContent = 'è·å–äºŒç»´ç å¤±è´¥ï¼š' + err.message;
      }
    }

    async function handleMockLogin() {
      try {
        await fetchJson('/api/auth/mock-login', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ nickname: 'æµ‹è¯•ç”¨æˆ·' })
        });
        window.location.href = '/my';
      } catch (err) {
        Sweetalert2.fire({
          title: 'ç™»å½•å¤±è´¥',
          text: err.message,
          icon: 'error',
          confirmButtonColor: '#667eea',
          width: '320px'
        });
      }
    }

    // æ£€æŸ¥ç™»å½•çŠ¶æ€
    checkStatus();
    
    // åˆå§‹åŒ–äºŒç»´ç 
    refreshQr();
    
    // ç»‘å®šäº‹ä»¶
    document.getElementById('btnRefreshQr').addEventListener('click', refreshQr);
  </script>
</body>
</html>